> 题目来源：知乎

## 答案：重拾

因为golang的原生map是非并发安全的，所以为了保证map的并发安全，最简单的方式就是给map加锁。直接对一个map加锁，当访问map的请求越来越多，都竞争这一把锁使得并发访问变慢。

分段锁是一种锁的设计，并不是具体的一种锁，分段锁顾名思义就是将锁分段，将锁的粒度变小，将存储的对象分散到各个分片（shard）中，每个分片由一把锁控制，我们将 key 分散到固定数量的 shard 中避免 rehash 操作。shard 是有锁保护的 map, 当 shard 进行 rehash 时会阻塞shard内的读写，但不会对其他 shard 造成影响。这样使得当需要对在A分片上的数据进行读写时不会影响B分片的读写。

虽然有sync.Map存在，但是通过压力测试对比，分段锁的性能更好